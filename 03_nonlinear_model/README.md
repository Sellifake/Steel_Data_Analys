# 钢卷性能预测 - 非线性模型

## 项目概述

本模块专注于使用支持向量回归（SVR）对钢卷性能指标进行预测建模。通过超参数调优和K折交叉验证，构建高性能的非线性预测模型，并提供特征重要性分析和扰动预测功能。

## 最终结果保存位置

- **调优后模型性能**: `results/02_svr_tuned_results/svr_tuned_performance_summary.csv` - 调优后的模型性能指标
- **训练好的模型**: `results/02_svr_tuned_results/saved_models/` - 保存的调优后模型文件（.joblib格式）
- **特征重要性**: `results/02_svr_tuned_results/` 文件夹中的特征重要性图表和CSV文件
- **扰动预测结果**: `results/02_svr_tuned_results/` 文件夹中的PDP图表和预测结果CSV文件
- **超参数搜索结果**: 调优过程中的参数搜索记录

## 代码文件详细说明

### 1. 02a_svr_tuning.py - 支持向量回归超参数调优建模

**功能**: 使用支持向量回归（SVR）进行性能预测，并进行超参数调优

**输入文件**:
- `../01_read_data/results/04_data_selected.xlsx` - 经过特征筛选的最终数据集

**输出文件**:
- `results/02_svr_tuned_results/` - SVR调优结果文件夹
- `saved_models/` - 调优后的SVR模型
- `*_feature_importance.png/csv` - 特征重要性分析
- `svr_tuned_performance_summary.csv` - 调优后性能汇总

**主要功能**:
- 使用RandomizedSearchCV对SVR的C和gamma参数进行调优（50次迭代）
- 使用RBF核函数的SVR模型
- 使用Pipeline捆绑StandardScaler和SVR
- 5折交叉验证评估调优后的最佳SVR模型性能
- 使用排列重要性（Permutation Importance）作为特征重要性衡量标准
- 处理高维特征空间中的非线性关系

**性能表现**:
- 抗拉强度: R²=0.8790, MAE=8.0739, RMSE=11.4235
- 屈服Rp0.2值*: R²=0.7220, MAE=10.6273, RMSE=15.0682
- 断后伸长率: R²=0.4237, MAE=2.0975, RMSE=2.8017

### 2. 02b_svr_perturbation_predict.py - SVR扰动预测

**功能**: 使用调优后的SVR模型对扰动数据进行预测分析

**输入文件**:
- `results/02_svr_tuned_results/saved_models/` - 调优后的SVR模型
- `../01_read_data/results/05_perturbed_dataset_*.csv` - 扰动数据集

**输出文件**:
- `02b_svr_prediction_results_*.csv` - 详细预测结果（ICE）
- `02b_svr_summary_stats_*.csv` - 统计汇总结果（PDP）
- `02b_pdp_plot_*.png` - 部分依赖图（带95%置信区间）

**主要功能**:
- 加载调优后的SVR模型进行扰动预测
- 数据清洗：移除空行或全0行，处理NaN值
- 生成带置信区间的PDP效应图
- 分析关键工艺参数对性能指标的影响趋势
- 提供性能指标基线参考线

## 模型特点与优势

### 支持向量回归（SVR）
- **高维处理能力**: 在高维特征空间中表现优异
- **核技巧**: 通过RBF核函数处理非线性关系
- **稀疏性**: 只使用支持向量进行预测，计算效率高
- **鲁棒性**: 对异常值具有一定的抗干扰能力
- **正则化**: 通过C参数控制模型复杂度，防止过拟合
- **适用场景**: 适合处理非线性关系和小到中等规模数据集

## 超参数调优策略

### SVR调优参数
- **C参数**: 控制正则化强度，搜索范围0.1-1000（对数均匀分布）
- **gamma参数**: RBF核函数的带宽参数，搜索范围0.0001-0.1（对数均匀分布）
- **搜索策略**: 使用RandomizedSearchCV进行50次迭代搜索
- **交叉验证**: 5折交叉验证评估模型性能

## 特征重要性分析

- **排列重要性**: 通过随机打乱特征值评估特征重要性
- **计算方式**: 使用sklearn的permutation_importance函数
- **重复次数**: 10次重复计算以提高稳定性
- **可视化**: 生成Top 20特征的水平条形图
- **CSV导出**: 保存完整的重要性数据供进一步分析

## 扰动预测分析

通过PDP（部分依赖图）分析关键工艺参数对性能指标的影响：
- **热点峰值温度**: 分析最高温度点对性能的影响
- **冷点峰值温度**: 分析最低温度点对性能的影响
- **保温时长**: 分析保温时间对性能的影响

每个扰动分析都包含：
- **ICE数据**: 个体条件期望的详细预测结果
- **PDP统计**: 按扰动值分组的统计汇总（均值、中位数、95%置信区间）
- **可视化图表**: 带置信区间的PDP效应图
- **性能基线**: 显示性能指标的最小值和最大值基线

## 数据预处理特点

### SVR特定的数据清洗
- **空行处理**: 移除所有特征列都为NaN的行
- **零值处理**: 移除所有特征列都为0的行
- **NaN填充**: 对剩余的零星NaN值使用0填充
- **标准化**: Pipeline中自动进行StandardScaler标准化

## 模型性能评估

每个调优后的模型都会生成详细的性能评估报告，包括：
- **R²分数**: 决定系数，衡量模型解释方差的能力
- **MAE**: 平均绝对误差
- **RMSE**: 均方根误差
- **交叉验证结果**: 5折交叉验证的均值和标准差
- **最佳参数**: 调优后找到的最优超参数组合

## 性能对比

| 性能指标 | SVR R² | 随机森林 R² | XGBoost R² | LightGBM R² |
|----------|--------|-------------|------------|-------------|
| 抗拉强度 | 0.8790 | 0.8991 | 0.9022 | 0.8962 |
| 屈服Rp0.2值* | 0.7220 | 0.7670 | 0.7766 | 0.7655 |
| 断后伸长率 | 0.4237 | 0.5044 | 0.5194 | 0.5120 |



## 注意事项

- 请确保已运行01_read_data模块生成最终数据集
- SVR模型对数据标准化敏感，Pipeline中已包含StandardScaler
- 扰动预测需要先生成扰动数据集（01_read_data模块的05脚本）
- 所有模型都设置了随机种子确保结果可复现
- SVR的计算复杂度较高，预测时间相对较长
- 建议按顺序运行脚本：先运行02a_svr_tuning.py，再运行02b_svr_perturbation_predict.py
- SVR适合处理非线性关系，但在某些指标上可能不如集成学习方法表现优异